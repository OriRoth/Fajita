\subsubsection*{Building the automaton's dependency graph}

  We employ the following convention:
  lower case letters from the beginning of the Latin alphabet,~$a$,~$b$, $c$, …,
  denote \emph{terminals} (but never the special terminal~$\cc{\$}$),
    upper case such letters~$A$,~$B$, $C$, …, denote \emph{variables}
  (but never the automatically generated special variable $S'$), 
  nonterminals(not including S').
  An upper case sans-serif letter $\mathsf X$, $\mathsf Y$, denote
    either symbols, i.e., either variables or terminals,
    while lower case Greek~$α$, $β$, $γ$, \ldots denote \emph{strings} of grammar symbols

    Let~$σ$ be a transition from~$Q$ then~$Q_{σ}$
    is the instantiation of~$action(Q_{B},σ)$ in context
    of~$Q$
    Let~$σ₂$be a transition from~$Q_{σ₁}$ then~$Q_{σ₁σ₂}$
    is the instantiation of~$action(Q_{σ₁},σ₂)$
    in context of~$Q$
\begin{figure}
  \begin{algorithmic}[1]
    %\protect\caption{Instantiating state's type argument.}
    \REQUIRE{An LR(1) parser~$P$}.
    \ENSURE{The dependency graph~$G =⟨V, E⟩$}
    \STATE{$G=(E,V)←∅$} \COMMENT {Output graph is initially empty}
    \FORALL[Create initial set of vertices of~$G$]{$⟨Qᵢ,Qⱼ,X⟩∈\textsf{edges}(P)$}
    \STATE{$V←❴ Q_{X}|Q∈P∧∃transition(Q,X)❵$}
    \ENDFOR
    \FORALL[Create edges of~$G$]{state~$Q∈P$}
    \FORALL{$∀[A→·Xα,b]∈Q$}
    \STATE~$Q_{Ab}←\textsf{Find}(Q,A,b)$
    \STATE~$V←V\cup \bigcup❴ Q_{Ab}❵~$
    \STATE~$E←E\cup \bigcup❴ (Q_{Ab},Q_{X})❵~$
    \ENDFOR
    \FORALL{$[A→·Cd,b]∈Q$}
    \STATE~$Q_{Ab}←\textsf{Find}(Q,A,b)$
    \STATE~$Q_{Cd}←\textsf{Find}(Q,C,d)$
    \IF{$Q_{Cd}$ is not inherited ($≠(A,i,b)$ )}
    \STATE~$V←V\cup \bigcup❴ Q_{Ab},Q_{Cd}❵~$
    \STATE~$E←E\cup \bigcup❴ (Q_{Ab},Q_{Cd})❵~$
    \ENDIF
    \ENDFOR
    \FORALL {$Q_{Ab}∈V.Q_{Ab}≠(A,i,b)$}
    \STATE~$E←E\cup \bigcup❴ (Q_{A},Q_{Ab})❵~$
    \STATE~$Q_{b}^{A}←\textsf{Find}(Q^{A},b)$
    \STATE~$E←E\cup \bigcup❴ (Q_{b}^{A},Q_{Ab})❵~$
    \ENDFOR
    \ENDFOR
    \RETURN{$⟨V,E⟩$}
  \end{algorithmic}
\end{figure}

\endinput
\COMMENT{Returns the state that will consume b, or null, if it cannot be determined.}

\begin{description}
\STATE [{Function}]~$\textsf{Find}(Q,A,b)$ returns ContexedState\end{description}
  \begin{enumerate}
    \STATE If~$action(Q_{A},b)=sᵢ$
          \begin{enumerate}
            \STATE return~$Qᵢ$
          \end{enumerate}
    \STATE else //$Q_{A}$ reduces by rule~$Carrowα·,b$
          \begin{enumerate}
            \STATE If~$|α|>1$
                  \begin{enumerate}
                    \STATE return~$(C,|α|-1,b)$ //‟Inherited TA”
                  \end{enumerate}
            \STATE else if~$|α|=1$ ($α=A$ )
                  \begin{enumerate}
                      \STATE return~$\textsf{Find}(Q,C,b)$
                  \end{enumerate}
            \STATE else //$α=ε$
                  \begin{enumerate}
                      \STATE return~$\textsf{Find}(Q^{A},C,b)$
                  \end{enumerate}
          \end{enumerate}
  \end{enumerate}
  \begin{description}
      \STATE [{Function}]~$\textsf{Find}(Q,b)$ returns ContexedState
  \end{description}
  \begin{enumerate}
    \STATE If~$action(Q,b)=sᵢ$
          \begin{enumerate}
            \STATE return~$Qᵢ$
          \end{enumerate}
    \STATE else //$Q$ reduces by rule~$Carrowα·,b$
          \begin{enumerate}
            \STATE If~$|α|>0$
                  \begin{enumerate}
                    \STATE return~$(C,|α|-1,b)$ //‟Inherited TA”
                  \end{enumerate}
            \STATE else //$α=ε$
                  \begin{enumerate}
                      \STATE return~$\textsf{Find}(Q,C,b)$
                  \end{enumerate}
          \end{enumerate}
  \end{enumerate}
  \STATE [{Complexity:}]~
  \begin{itemize}
    \STATE~$V=O()$
    \STATE~$E=O()$
  \end{itemize}
\end{description}
\end{algorithmic}

\begin{algorithmic}
  \COMMENT{Instantiating type arguments for state s}
  \begin{description}
    \STATE [{Input:}] A dependency graph~$G=(V,E)$ for state~$Q_{B}$.
    \STATE [{Output:}] An instantiated class for s.
    \STATE [{Method:}]~
    \begin{enumerate}
      \STATE Handle dependency cycles.
      \STATE Run a topoligical sort on~$G$ ( we now know~$G$ is a~$DAG$)
      \STATE for each~$S$ in topological order:
            \begin{enumerate}
              \STATE If~$S=Q_{X}$
                    \begin{enumerate}
                      \STATE~$FillSingleTransition(Q_{X})$
                    \end{enumerate}
              \STATE Else if~$S=Q_{XY}$
                    \begin{enumerate}
                      \STATE~$FillDoubleTransition(Q_{XY})$
                    \end{enumerate}
            \end{enumerate}
    \end{enumerate}
    \begin{description}
      \STATE [{Function}]~$FillSingleTransition(Q_{X}):$
      \begin{enumerate}
        \STATE If~$Q_{X}=(A,i,b)$
              \begin{enumerate}
                \STATE return;
              \end{enumerate}
        \STATE For each triplet~$(A,i,a)∈Q_{X}$
              \begin{enumerate}
                \STATE If~$(A,i-1,a)∈Q$ then //inherited TA(Type Argument)
                      \begin{enumerate}
                        \STATE~$Q_{X}[(A,i,a)]:=Q[(A,i-1,a)]$
                      \end{enumerate}
                \STATE Else // synthesized from~$Q$
                      \begin{enumerate}
                        \STATE~$Q_{X}[(A,i,a)]:=Q_{Aa}$
                      \end{enumerate}
              \end{enumerate}
      \end{enumerate}
      \STATE [{Function}]~$FillDoubleTransition(Q_{XY})$:
      \begin{enumerate}
        \STATE If~$Q_{XY}=(A,i,b)$
              \begin{enumerate}
                \STATE return;
              \end{enumerate}
        \STATE For each triplet~$(A,i,a)∈Q_{XY}$
              \begin{enumerate}
                \STATE If~$(A,i-2,a)∈Q$ then //inherited TA(Type Argument)
                      \begin{enumerate}
                        \STATE~$Q_{XY}[(A,i,a)]:=Q[(A,i-2,a)]$
                      \end{enumerate}
                \STATE Else If~$(A,i-1,a)∈Q_{X}$// synthesized from~$Q$
                      \begin{enumerate}
                        \STATE~$Q_{XY}[(A,i,a)]:=Q_{Aa}$
                      \end{enumerate}
                \STATE Else If~$Q_{Aa}^{X}=(C,j,d)$// Synthesized from~$Q_{X}$
                      real result on~$Q$
                      \begin{enumerate}
                        \STATE~$Q_{XY}:=Q_{Cd}$
                      \end{enumerate}
                \STATE Else //Synthes ized from~$Q_{X}$ , concrete
                      \begin{enumerate}
                        \STATE~$Q_{XY}[(A,i,a)]:=Q_{Aa}^{X}$
                      \end{enumerate}
              \end{enumerate}
      \end{enumerate}
    \end{description}
    \STATE [{Complexity:}]~
    Instantiation algorithm time complexity:~$O()$
\end{description}
    \end{algorithmic}
